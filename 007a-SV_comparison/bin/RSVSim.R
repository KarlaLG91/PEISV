## DESCRIPTION:
## R script to run RSVSim algorithm in order to compare overlap between simulated structural variants (SVs) and estimated SVs.
## The script uses BED files generated by various SVs detection tools and CSV files of simulated SVs to compare an overlap of at least 80% using RSVSim. 
##
## USAGE:
## This R script is called by the mkfile of this module with the following command:
##      `Rscript --vanilla bin/RSVSim.R <SIMsv> <Path to BED file> <Output file> <TOL>`;
##					where <SIMsv> is the variable $SIMsv found in the `config.mk` file in this module,
##                                      <Path to BED> is the path to any file in data/,
##                                      <Output file> is any line printed by the `/bin/create-targets` script in this module,
##                                      and <TOL> is the variable $TOL found in the `config.mk` file in this module.
## AUTHOR:
##      Karla Lozano (klg1219sh@gmail.com), for Winter Genomics (http://www.wintergenomics.com/) - 2018


# Reading arguments from shell
#
args = commandArgs(trailingOnly = TRUE)

# args[1]=CSV file with simulated SVs
# args[2]=BED file with estimated SVs
# args[3]=Output file with overlap
# args[4]=tolerance for overlap


# Loading the package RSVSim
#
library(RSVSim)

# Checking for overlap between simulated SVs and estimated SVs
# Sendind STDERR to output file
#
overlap <- file(args[3], open="wt")
sink(overlap, type="message")
simSVs <- read.table(args[1], sep= '\t', header = TRUE)
querySVs <- read.table(args[2], sep= '\t', header = TRUE)
compareSV(querySVs, simSVs, tol=as.numeric(args[4]))
sink(type="message")
close(overlap)

# Directing STDOUT to output file
#
sink(args[3], append=TRUE)
simSVs <- read.table(args[1], sep= '\t', header = TRUE)
querySVs <- read.table(args[2], sep= '\t', header = TRUE)
compareSV(querySVs, simSVs, tol=as.numeric(args[4]))
sink()
